# 深入理解 Linux 内核
________

## 内存寻址
---
> 深入理解 linux 内核一书中 内存寻址提到 进程分配的线性地址为0x2003ffff 时 directory字段所用的最高10位为啥是0x080

> 深入理解 linux 内核一书中 内存寻址提到 进程分配的线性地址为0x2003ffff 时 directory字段所用的最高10位为啥是0x080
在 Linux 内核中，进程的线性地址空间被分为两部分：用户空间和内核空间。用户空间的地址范围是 0x00000000 到 0xffffffff，而内核空间的地址范围是 0xc0000000 到 0xffffffff。因此，进程分配的线性地址为 0x2003ffff 时，它属于用户空间地址范围。

> 在 x86 架构中，线性地址需要经过两级转换才能映射到物理地址。第一级转换使用页目录表（Page Directory Table），第二级转换使用页表（Page Table）。在进行第一级转换时，线性地址的高 10 位用于索引页目录表中的一个表项，该表项指向一个页表。在进行第二级转换时，线性地址的中间 10 位用于索引页表中的一个表项，该表项指向一个物理页帧。

> 因此，当进程分配的线性地址为 0x2003ffff 时，它的高 10 位为 0x2003f，用于索引页目录表中的一个表项。而这个表项所用的最高 10 位为 0x080，是因为在 Linux 内核中，用户空间的页目录表项所用的最高 10 位是 0x080。这是为了避免与内核空间的页目录表项混淆，因为内核空间的页目录表项所用的最高 10 位是 0x1e0。

> 最高10位的0x080是怎么算出来的

> 最高10位的0x080是怎么算出来的
在 x86 架构中，线性地址需要经过两级转换才能映射到物理地址。第一级转换使用页目录表（Page Directory Table），第二级转换使用页表（Page Table）。在进行第一级转换时，线性地址的高 10 位用于索引页目录表中的一个表项，该表项指向一个页表。在进行第二级转换时，线性地址的中间 10 位用于索引页表中的一个表项，该表项指向一个物理页帧。

> 在 Linux 内核中，用户空间的页目录表项所用的最高 10 位是 0x080。这是因为在 x86 架构中，页目录表项的最高两位是保留位，必须为 0。而在 Linux 内核中，为了避免与内核空间的页目录表项混淆，用户空间的页目录表项所用的最高 10 位被设置为 0x080，这样就可以保证这些表项的最高两位都是 0。

> 因此，当进程分配的线性地址为 0x2003ffff 时，它的高 10 位为 0x2003f，用于索引页目录表中的一个表项。而这个表项所用的最高 10 位为 0x080，是为了保证这个表项是用户空间的页目录表项，而不是内核空间的页目录表项。

> 当用户空间时，这个索引页目录项的最高10位都是固定的0x080吗

> 当用户空间时，这个索引页目录项的最高10位都是固定的0x080吗
是的，当线性地址属于用户空间时，索引页目录表的最高 10 位都是固定的 0x080。这是因为在 x86 架构中，页目录表项的最高两位是保留位，必须为 0。而在 Linux 内核中，为了避免与内核空间的页目录表项混淆，用户空间的页目录表项所用的最高 10 位被设置为 0x080，这样就可以保证这些表项的最高两位都是 0。因此，当线性地址属于用户空间时，它的高 10 位都是固定的 0x080，用于索引页目录表中的一个表项。